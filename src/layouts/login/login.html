<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/components/tl-Input/tl-Input.html">
<link rel="import" href="/service/tl-Flux/tl-Flux.html">

<dom-module name="tl-login-layout">
	<link rel="import" type="css" href="./login.css">

	<template>
		<div id="base">
			<form id="loginBox" on-submit="onSubmit" method="/" action="POST">
				<h1 id="title">
					旅ログ
				</h1>
				<p id="error">{{errorMessage}}</p>
				<p>
					<tl-Input disabled={{disabled}} id="email" type="text" label="mail" value="{{email::input}}"></tl-Input>
				</p>
				<p>
					<tl-Input disabled={{disabled}} id="password" type="password" label="password" value="{{password::input}}"></tl-Input>
				</p>
				<div id="row">
					<div id="centeringLayer">
						<svg id="loader" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="48px" height="48px">
							<path id="loader-outer" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
						   s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
						   c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z" />
							<path id="loader-inner" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
						   C22.32,8.481,24.301,9.057,26.013,10.047z" />
						</svg>
					</div>
					<button disabled={{disabled}} type="submit" id="submit">
						<tl-i18n id="action.login"></tl-i18n>
					</button>
				</div>
			</form>
		</div>
	</template>

	<script>
		(function() {
			Polymer({
				is: 'tl-login-layout',
				properties: {
					email: {
						type: String,
						notify: true
					},
					password: {
						type: String,
						notify: true
					},
					errorMessage: {
						type: String,
						value: ''
					},
					disabled: {
						type: Boolean,
						value: false
					},
					loading: {
						type: Boolean,
						value: false,
						reflectToAttribute: true
					}
				},
				ready: function() {
					Flux.addStore('/Store/AuthStore.js', this.onUpdateAuthStore.bind(this));
				},
				onSubmit: function(ev) {
					ev.stopImmediatePropagation();
					ev.preventDefault();

					Flux.dispatchAction('login', {
						email: this.email,
						password: this.password
					});
				},
				onUpdateAuthStore: function(state) {
					this.email = state.inputEmail;
					this.password = state.inputPassword;
					this.disabled = state.isLoading;
					this.loading = state.isLoading;
					this.errorMessage = state.errorMessage;
				}
			});
		})();

	</script>
</dom-module>
